## 选举

人工设置超时时间，所有follower一起计算时间，一旦超时，则follower变为候选人发起投票，一个follower或候选人如果没有投过票则会响应投票，本质上就是谁快谁就当选

当选后候选人成为leader，其任期+1,leader会向其他follower定期发送心跳

如果其中有任何一个follower没有在超时期间内接到leader的心跳，它会再次发起投票选举新的leader，一般某个follower收不到心跳的原因有两个
  - 1.leader挂掉
  - 2.follower被分到另一个区了

如果多个候选人平票，则平票候选人再进行一次选举

## 日志复制

api发起一条对数据库更新的命令给leader，leader会通过类似心跳检测的方式向所有follower确认，响应的follower组成待更新组

待更新组数量满足复制多数时当前更新才能继续（一般是节点数量的一半以上）

之后leader首先自己更新数据并返回成功结果，之后再次发起心跳检测向待更新组的follower发送数据让他们也更新

分区时：
  - 当发生分区，此时两个不同的区会选举出两个新的leader，如果连个不同的client分别向两个分区发送数据时会产生数据一致性问题
  - raft中的解决策略是根据任期，因为此时无法满足复制多数的分区是无法完成任何更新的，只有满足复制多数的分区可以更新数据，每次更新完成数据任期+1
  - 当分区结束后，少数区的leader任期会少于多数区，此时少数区leader退出leader状态变为follower，同时该区所有节点回滚，根据多数区leader的append日志更新自己的数据到当前状态
